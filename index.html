<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AccessibleChennai - Mode Selection</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0ea5e9;
      --secondary: #06b6d4;
      --accent: #f59e0b;
      --success: #10b981;
      --dark: #0f172a;
      --gradient-primary: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
    }

    body {
      background: linear-gradient(-45deg, #0f172a, #1e293b, #334155, #475569);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .glass-dark {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .pulse-ring {
      animation: pulseRing 2s infinite;
    }

    @keyframes pulseRing {
      0% { transform: scale(0.33); opacity: 1; }
      40%, 50% { opacity: 1; }
      100% { opacity: 0; transform: scale(1.2); }
    }

    .floating {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .listening-animation {
      animation: listening 1.5s ease-in-out infinite;
    }

    @keyframes listening {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.1); opacity: 1; }
    }

    .text-gradient {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .voice-wave {
      animation: voiceWave 0.8s ease-in-out infinite alternate;
    }

    @keyframes voiceWave {
      0% { height: 10px; }
      100% { height: 30px; }
    }

    .loading-dots::after {
      content: '';
      animation: loadingDots 1.5s infinite;
    }

    @keyframes loadingDots {
      0% { content: ''; }
      25% { content: '.'; }
      50% { content: '..'; }
      75% { content: '...'; }
      100% { content: ''; }
    }

    .fade-in {
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-up {
      transform: translateY(50px);
      opacity: 0;
      transition: all 0.8s ease;
    }

    .slide-up.visible {
      transform: translateY(0);
      opacity: 1;
    }
  </style>
</head>
<body class="text-white min-h-screen flex items-center justify-center">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <!-- Logo and Welcome -->
    <div class="mb-12 slide-up">
      <div class="flex items-center justify-center mb-6">
        <div class="relative">
          <i class="fas fa-wheelchair text-sky-400 text-6xl floating"></i>
          <div class="absolute inset-0 bg-sky-400 opacity-20 blur-lg rounded-full pulse-ring"></div>
        </div>
      </div>
      <h1 class="text-5xl md:text-6xl font-bold mb-4">
        <span class="text-gradient">Welcome to</span><br>
        <span class="text-white">AccessibleChennai</span>
      </h1>
      <p class="text-xl text-gray-300 mb-8">
        Choose your preferred interaction mode to get started
      </p>
    </div>

    <!-- Mode Selection Interface -->
    <div class="glass-dark p-12 rounded-3xl mb-8 slide-up" id="modeSelector">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-white mb-4">
          <i class="fas fa-cog text-sky-400 mr-3"></i>
          Select Your Mode
        </h2>
        <p class="text-gray-300 text-lg">
          Say "Voice Mode" or "Normal Mode" or click the buttons below
        </p>
      </div>

      <!-- Voice Input Indicator -->
      <div class="mb-8" id="voiceIndicator">
        <div class="flex items-center justify-center mb-4">
          <div class="w-16 h-16 bg-gradient-to-r from-sky-500 to-cyan-500 rounded-full flex items-center justify-center" id="micIcon">
            <i class="fas fa-microphone text-2xl text-white"></i>
          </div>
        </div>
        <p class="text-sky-400 font-medium" id="listeningText">Click the microphone or say your preference</p>
        
        <!-- Voice Wave Animation -->
        <div class="flex items-center justify-center space-x-1 mt-4 hidden" id="voiceWaves">
          <div class="w-1 bg-sky-400 voice-wave" style="animation-delay: 0s;"></div>
          <div class="w-1 bg-sky-400 voice-wave" style="animation-delay: 0.1s;"></div>
          <div class="w-1 bg-sky-400 voice-wave" style="animation-delay: 0.2s;"></div>
          <div class="w-1 bg-sky-400 voice-wave" style="animation-delay: 0.3s;"></div>
          <div class="w-1 bg-sky-400 voice-wave" style="animation-delay: 0.4s;"></div>
        </div>
      </div>

      <!-- Manual Selection Buttons -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <button 
          class="glass p-8 rounded-2xl hover:bg-gradient-to-br hover:from-sky-500/20 hover:to-cyan-500/20 transition-all duration-300 group"
          onclick="selectMode('voice')"
          id="voiceModeBtn">
          <div class="w-16 h-16 bg-gradient-to-r from-emerald-500 to-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
            <i class="fas fa-volume-up text-2xl text-white"></i>
          </div>
          <h3 class="text-2xl font-bold text-white mb-3">Voice Mode</h3>
          <p class="text-gray-300">
            Full voice interaction with audio feedback for all actions and navigation
          </p>
          <div class="mt-4 flex items-center justify-center space-x-2 text-sm text-green-400">
            <i class="fas fa-check"></i>
            <span>Recommended for visually impaired users</span>
          </div>
        </button>

        <button 
          class="glass p-8 rounded-2xl hover:bg-gradient-to-br hover:from-purple-500/20 hover:to-pink-500/20 transition-all duration-300 group"
          onclick="selectMode('normal')"
          id="normalModeBtn">
          <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
            <i class="fas fa-mouse-pointer text-2xl text-white"></i>
          </div>
          <h3 class="text-2xl font-bold text-white mb-3">Normal Mode</h3>
          <p class="text-gray-300">
            Traditional visual interface with click and touch interactions
          </p>
          <div class="mt-4 flex items-center justify-center space-x-2 text-sm text-purple-400">
            <i class="fas fa-eye"></i>
            <span>Standard visual interaction</span>
          </div>
        </button>
      </div>
    </div>

    <!-- Loading/Processing State -->
    <div class="glass-dark p-8 rounded-3xl hidden" id="loadingState">
      <div class="flex items-center justify-center mb-4">
        <div class="w-12 h-12 border-4 border-sky-400 border-t-transparent rounded-full animate-spin"></div>
      </div>
      <p class="text-xl text-white loading-dots" id="loadingText">Processing your selection</p>
    </div>

    <!-- Voice Commands Help -->
    <div class="mt-8 glass p-6 rounded-2xl slide-up">
      <h3 class="text-lg font-semibold text-white mb-3">
        <i class="fas fa-info-circle text-sky-400 mr-2"></i>
        Voice Commands
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300">
        <div>
          <span class="text-green-400 font-medium">"Voice Mode"</span> - Enable full voice interaction
        </div>
        <div>
          <span class="text-purple-400 font-medium">"Normal Mode"</span> - Use standard interface
        </div>
      </div>
    </div>
  </div>

  <script>
    let recognition;
    let isListening = false;
    let speechSynthesis = window.speechSynthesis;
    let selectedMode = null;

    // Initialize speech recognition
    function initializeSpeechRecognition() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'en-US';

        recognition.onstart = function() {
          isListening = true;
          updateUI('listening');
          speak("Please say Voice Mode for full audio assistance, or Normal Mode for standard interaction");
        };

        recognition.onresult = function(event) {
          let finalTranscript = '';
          for (let i = event.resultIndex; i < event.results.length; i++) {
            if (event.results[i].isFinal) {
              finalTranscript += event.results[i][0].transcript;
            }
          }

          if (finalTranscript) {
            processVoiceCommand(finalTranscript.toLowerCase().trim());
          }
        };

        recognition.onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          updateUI('error');
          speak("Sorry, I couldn't hear you clearly. Please try again or use the buttons.");
        };

        recognition.onend = function() {
          isListening = false;
          if (!selectedMode) {
            updateUI('ready');
          }
        };

        // Start listening automatically
        setTimeout(() => {
          startListening();
        }, 2000);
      } else {
        console.warn('Speech recognition not supported');
        speak("Voice recognition is not supported in your browser. Please use the buttons to select your mode.");
      }
    }

    // Text-to-speech function
    function speak(text, callback) {
      if (speechSynthesis) {
        speechSynthesis.cancel(); // Cancel any ongoing speech
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 0.9;
        utterance.pitch = 1;
        utterance.volume = 0.8;
        
        if (callback) {
          utterance.onend = callback;
        }
        
        speechSynthesis.speak(utterance);
      }
    }

    // Start listening for voice commands
    function startListening() {
      if (recognition && !isListening) {
        try {
          recognition.start();
        } catch (error) {
          console.error('Error starting recognition:', error);
        }
      }
    }

    // Stop listening
    function stopListening() {
      if (recognition && isListening) {
        recognition.stop();
      }
    }

    // Process voice commands
    function processVoiceCommand(command) {
      console.log('Received command:', command);
      
      if (command.includes('voice mode') || command.includes('voice')) {
        selectMode('voice');
      } else if (command.includes('normal mode') || command.includes('normal')) {
        selectMode('normal');
      } else {
        speak("I didn't understand. Please say Voice Mode or Normal Mode, or use the buttons.");
        updateUI('ready');
      }
    }

    // Mode selection function
    function selectMode(mode) {
      selectedMode = mode;
      stopListening();
      updateUI('loading');

      if (mode === 'voice') {
        speak("Voice Mode selected. Enabling full audio assistance. Redirecting to the main application.", () => {
          // Store the mode preference
          sessionStorage.setItem('accessibilityMode', 'voice');
          // Redirect to main page after a short delay
          setTimeout(() => {
            redirectToMainPage();
          }, 1000);
        });
      } else {
        speak("Normal Mode selected. Using standard interface.", () => {
          sessionStorage.setItem('accessibilityMode', 'normal');
          setTimeout(() => {
            redirectToMainPage();
          }, 1000);
        });
      }
    }

    // Update UI based on state
    function updateUI(state) {
      const micIcon = document.getElementById('micIcon');
      const listeningText = document.getElementById('listeningText');
      const voiceWaves = document.getElementById('voiceWaves');
      const loadingState = document.getElementById('loadingState');
      const modeSelector = document.getElementById('modeSelector');

      switch(state) {
        case 'listening':
          micIcon.classList.add('listening-animation');
          micIcon.innerHTML = '<i class="fas fa-microphone text-2xl text-white"></i>';
          listeningText.textContent = 'Listening... Say "Voice Mode" or "Normal Mode"';
          listeningText.classList.add('text-green-400');
          voiceWaves.classList.remove('hidden');
          break;
          
        case 'loading':
          modeSelector.classList.add('hidden');
          loadingState.classList.remove('hidden');
          break;
          
        case 'error':
          micIcon.classList.remove('listening-animation');
          micIcon.innerHTML = '<i class="fas fa-microphone-slash text-2xl text-red-400"></i>';
          listeningText.textContent = 'Error occurred. Click to try again or use buttons.';
          listeningText.classList.add('text-red-400');
          voiceWaves.classList.add('hidden');
          break;
          
        default: // ready
          micIcon.classList.remove('listening-animation');
          micIcon.innerHTML = '<i class="fas fa-microphone text-2xl text-white"></i>';
          listeningText.textContent = 'Click the microphone or say your preference';
          listeningText.className = 'text-sky-400 font-medium';
          voiceWaves.classList.add('hidden');
      }
    }

    // Redirect to main page
    function redirectToMainPage() {
      // You can replace this with your actual homepage path
      window.location.href = 'home.html'; // or wherever your main page is located
    }

    // Microphone click handler
    document.getElementById('micIcon').addEventListener('click', function() {
      if (!isListening) {
        startListening();
      } else {
        stopListening();
        updateUI('ready');
      }
    });

    // Button hover effects with voice feedback
    document.getElementById('voiceModeBtn').addEventListener('mouseenter', function() {
      if (selectedMode !== 'voice') {
        speak("Voice Mode - Full audio assistance");
      }
    });

    document.getElementById('normalModeBtn').addEventListener('mouseenter', function() {
      if (selectedMode !== 'normal') {
        speak("Normal Mode - Standard visual interface");
      }
    });

    // Keyboard accessibility
    document.addEventListener('keydown', function(e) {
      if (e.key === 'v' || e.key === 'V') {
        selectMode('voice');
      } else if (e.key === 'n' || e.key === 'N') {
        selectMode('normal');
      } else if (e.key === ' ' || e.key === 'Enter') {
        if (!isListening) {
          startListening();
        }
      }
    });

    // Initialize animations
    function initializeAnimations() {
      const elements = document.querySelectorAll('.slide-up');
      elements.forEach((el, index) => {
        setTimeout(() => {
          el.classList.add('visible');
        }, 200 + (index * 100));
      });
    }

    // Welcome speech
    function welcomeUser() {
      setTimeout(() => {
        speak("Welcome to Accessible Chennai. This app will help you navigate the city with full accessibility support. Please choose your interaction mode.");
      }, 1000);
    }

    // Initialize everything when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initializeAnimations();
      welcomeUser();
      initializeSpeechRecognition();
    });

    // Handle page visibility change
    document.addEventListener('visibilitychange', function() {
      if (document.hidden && isListening) {
        stopListening();
      }
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
      if (speechSynthesis) {
        speechSynthesis.cancel();
      }
      if (recognition && isListening) {
        recognition.stop();
      }
    });
  </script>
</body>
</html>